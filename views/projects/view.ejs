<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Project Details - Project Management Tool</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="/css/custom.css">
  <style>
    body { background: #f8f6ff; }
    .purple-btn { background: #7c3aed; color: #fff; border: none; }
    .purple-btn:hover { background: #5b21b6; }
    .purple-card { background: #ede9fe; border: none; }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="card purple-card shadow p-4 mb-4">
      <h2 class="fw-bold mb-2" style="color:#7c3aed;"><i class="fa-solid fa-folder"></i> <%= project.name %>
        <% if (project.completed) { %> <span class="badge bg-success">Completed</span> <% } %>
        <% if (project.archived) { %> <span class="badge bg-secondary">Archived</span> <% } %>
      </h2>
      <p><%= project.description %></p>
      <h5 class="mt-4">Members:</h5>
      <ul>
        <% project.members.forEach(member => { %>
          <li><i class="fa-solid fa-user"></i> <%= member.username %> (<%= member.email %>)</li>
        <% }) %>
      </ul>
      <div class="mt-4 d-flex gap-2">
        <a href="/projects/<%= project._id %>/edit" class="btn purple-btn"><i class="fa-solid fa-pen"></i> Edit</a>
        <form method="POST" action="/projects/<%= project._id %>/delete" onsubmit="return confirm('Delete this project?');">
          <button type="submit" class="btn btn-danger"><i class="fa-solid fa-trash"></i> Delete</button>
        </form>
        <% if (project.createdBy && userId && project.createdBy.toString() === userId.toString()) { %>
          <% if (!project.archived) { %>
            <form method="POST" action="/projects/<%= project._id %>/archive" style="display:inline;"><button type="submit" class="btn btn-outline-secondary">Archive</button></form>
          <% } else { %>
            <form method="POST" action="/projects/<%= project._id %>/unarchive" style="display:inline;"><button type="submit" class="btn btn-outline-secondary">Unarchive</button></form>
          <% } %>
          <% if (!project.completed) { %>
            <form method="POST" action="/projects/<%= project._id %>/complete" style="display:inline;"><button type="submit" class="btn btn-outline-success">Complete</button></form>
          <% } else { %>
            <form method="POST" action="/projects/<%= project._id %>/uncomplete" style="display:inline;"><button type="submit" class="btn btn-outline-warning">Uncomplete</button></form>
          <% } %>
          <a href="/projects/<%= project._id %>/invite" class="btn btn-outline-secondary"><i class="fa-solid fa-user-plus"></i> Manage Members</a>
        <% } %>
        <a href="/dashboard" class="btn btn-outline-secondary">Back</a>
        <a href="/projects/<%= project._id %>/activity" class="btn btn-outline-secondary"><i class="fa-solid fa-clock"></i> Activity Feed</a>
      </div>
    </div>
    <a href="/projects/<%= project._id %>/tasks/new" class="btn purple-btn mb-4">
      <i class="fa-solid fa-plus"></i> Add Task
    </a>
    <div class="row g-4" id="kanban-board">
      <% const statuses = ['To Do', 'In Progress', 'Done']; %>
      <% statuses.forEach(status => { %>
        <div class="col-md-4">
          <div class="card purple-card shadow-sm">
            <div class="card-body">
              <h5 class="card-title" style="color:#7c3aed;"><%= status %></h5>
              <ul class="list-group kanban-column" data-status="<%= status %>" ondragover="event.preventDefault()" ondrop="onDrop(event, '<%= status %>')">
                <% (project.tasks || []).filter(task => task.status === status).forEach(task => { %>
                  <li class="list-group-item d-flex justify-content-between align-items-center kanban-task" draggable="true" ondragstart="onDragStart(event, '<%= task._id %>')">
                    <span><i class="fa-solid fa-thumbtack"></i> <%= task.title %></span>
                    <div>
                      <a href="/tasks/<%= task._id %>" class="btn btn-sm btn-outline-secondary"><i class="fa-solid fa-eye"></i></a>
                      <a href="/tasks/<%= task._id %>/edit" class="btn btn-sm purple-btn"><i class="fa-solid fa-pen"></i></a>
                    </div>
                  </li>
                <% }) %>
              </ul>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
    <script>
      let draggedTaskId = null;
      function onDragStart(event, taskId) {
        draggedTaskId = taskId;
      }
      function onDrop(event, newStatus) {
        event.preventDefault();
        if (!draggedTaskId) return;
        fetch(`/tasks/${draggedTaskId}/status`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status: newStatus })
        }).then(() => {
          location.reload();
        });
      }
    </script>
  </div>
</body>
</html> 