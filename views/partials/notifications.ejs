<div class="dropdown">
  <button class="btn btn-light position-relative" id="notifDropdown" data-bs-toggle="dropdown" aria-expanded="false">
    <i class="fa-solid fa-bell" style="color:#7c3aed;"></i>
    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" id="notifCount" style="display:none;">0</span>
  </button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notifDropdown" id="notifList" style="min-width:300px;">
    <li class="dropdown-item text-center text-muted">No notifications</li>
  </ul>
</div>
<script src="/socket.io/socket.io.js"></script>
<script>
  const notifCount = document.getElementById('notifCount');
  const notifList = document.getElementById('notifList');
  function loadNotifications() {
    fetch('/notifications').then(res => res.json()).then(data => {
      notifList.innerHTML = '';
      let unread = 0;
      if (data.length === 0) {
        notifList.innerHTML = '<li class="dropdown-item text-center text-muted">No notifications</li>';
      } else {
        data.forEach(n => {
          if (!n.read) unread++;
          notifList.innerHTML += `<li class="dropdown-item${n.read ? '' : ' fw-bold'}">
            <a href="${n.link || '#'}" style="color:#7c3aed; text-decoration:none;">${n.message}</a>
            <span class="small text-muted float-end">${new Date(n.createdAt).toLocaleString()}</span>
          </li>`;
        });
      }
      notifCount.textContent = unread;
      notifCount.style.display = unread > 0 ? '' : 'none';
    });
  }
  loadNotifications();
  socket.on('notify', () => {
    loadNotifications();
  });
</script> 